<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Monitor</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <style>
      body {
          padding-top: 70px;
      }
    </style>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="/js/api.js"></script>
    <script>
      const monitor = new Monitor();

      function update_plots() {
          const tbody = $('#plots > tbody');
          tbody.empty();
          monitor.plots.each((plot) => {
              const tr = $('<tr></tr>').appendTo(tbody);
              $('<td></td>').appendTo(tr).append(
                  $('<a></a>')
                      .text((plot.comment != '') ? plot.comment : '<no comment>')
                      .attr('href', '/plots/' + plot.id));
              $('<td></td>').appendTo(tr).attr('class', 'col-md-1').append(
                  $('<button></button>')
                      .text('Delete')
                      .attr('type', 'button')
                      .attr('class', 'btn btn-danger')
                      .on('click', () => monitor.plots.remove(plot).then(update_plots))
              );
          });
      }

      function update_logs() {
          const tbody = $('#logs > tbody');
          tbody.empty();
          monitor.logs.each((log) => {
              const tr = $('<tr></tr>').appendTo(tbody);
              $('<td></td>').appendTo(tr).text(log.path);
              $('<td></td>').appendTo(tr).text(log.comment);
              $('<td></td>').appendTo(tr).attr('class', 'col-md-1').append(
                  $('<button></button>')
                      .text('Delete')
                      .attr('type', 'button')
                      .attr('class', 'btn btn-danger')
                      .on('click', () => monitor.logs.remove(log).then(update_logs))
              );
          });
      }

      function add_plot() {
          const text = $('#comment');
          monitor.plots.add({comment: text.val()})
                 .then(() => {
                     update_plots();
                     text.val('');
                 });
      }

      $(document).ready(function() {
          monitor.plots.sync().then(update_plots);
          monitor.logs.sync().then(update_logs);
      });
    </script>
  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="#">Monitor</a>
        </div>
        <div class="collapse navbar-collapse" id="navbar">
        </div>
      </div>
    </nav>

    <div class="container">
      <div class="panel panel-default">
        <div class="panel-heading">
          <h2 class="panel-title pull-left">Plot</h2>
          <button type="button" class="btn btn-primary btm-sm pull-right" onclick="add_plot()">Create</button>
          <input id="comment" class="pull-right" type="text" placeholder="comment">
          <div class="clearfix"></div>
        </div>
        <table class="panel-body table table-bordered table-hover" id="plots">
          <tbody></tbody>
        </table>
      </div>

      <div class="panel panel-default">
        <div class="panel-heading">
          <h2 class="panel-title">Log</h2>
        </div>
        <table class="panel-body table table-bordered table-hover" id="logs">
          <tbody></tbody>
        </table>
      </div>
    </div>
  </body>
</html>
